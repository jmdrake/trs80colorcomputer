1 CLEAR 2000
4 SC=0
5 RD=48 : BU=32 : YW=16 : DIM CLR(3) : CLR(1)=RD : CLR(2)=BU : CLR(3)=YW
6 DEF FNY(P)=INT(P/16)
7 DEF FNX(P)=2*(P-32*INT(P/32))
8 DEF FNPY(Y)=Y*16
9 DEF FNPX(X)=X/2
10 EH=4 ' ENEMY HEIGHT
11 BH=2 ' BLASTER HEIGHT
12 BP=12 ' BLASTER POSITION
15 WD=8 ' SPRITE WIDTH
16 PR=3 ' ENEMIES PER ROW
17 ET=2 ' ENEMY TYPES
18 BR=14 ' BLASTER ROW
19 HT=EH : EC=ET*PR
20 DIM SP$(HT) 'SPRITE
21 DIM BF$(ET,HT) 'BUFFER
22 DIM SS$(ET+1, HT) 'SPRITE SHEET
23 DIM ES(ET,PR) ' ENEMY SHIPS
24 FOR R=1 TO ET
25 FOR C=1 TO PR
26 ES(R,C)=R
27 NEXT C
28 NEXT R
29 FOR S=1 TO ET+1
30 GOSUB 400 ' READ SPRITE FROM DATA
31 FOR J=1 TO HT
32 SS$(S,J)=SP$(J) ' COPY SPRITE TO SPRITESHEET
33 NEXT J: NEXT S
34 GOSUB 200 ' BUILD SPRITE BUFFER
35 P0=0
36 PD=1
37 CLS 0
38 XMAX=9
39 MM=10:DIM MX(MM),MY(MM)
40 REM GAME LOOP
45 B0 = 32*BR+BP
50 GOSUB 291 ' RENDER ENEMY BUFFER
60 P0=P0+PD
70 IF P0 <= XMAX THEN 80
75 P0 = XMAX : PD=-PD
80 IF P0 >= MN THEN 90
85 P0 = MN : PD = -PD
90 PRINT @0, SC;
95 P=B0 : SS=3 : HT=BH:  GOSUB 600 : HT=EH ' RENDER SHIP
99 REM KEYBOARD INPUTS
100 IF PEEK(343)=247 THEN BP=BP-1 ' MOVE BLASTER LEFT
101 IF PEEK(344)=247 THEN BP=BP+1 ' MOVE BLASTER RIGHT
103 IF PEEK(341)=247 THEN GOSUB 800 ' FIRE MISSILE
104 IF MC > 0 THEN GOSUB 850 ' RENDER MISSILES
109 IF A$ = "X" THEN MG$="YOU QUIT":GOTO 140
110 GOSUB 1200
120 GOSUB 1300
130 GOTO 40
140 PRINT @0, MG$;:END
200 REM BUFFER
201 BL$=STRING$(WD, CHR$(128))
204 PT=P0
205 FOR E = 1 TO ET
210 FOR R = 1 TO HT
211 BF$(E,R)=""
215 FOR I = 1 TO PR
216 IF ES(E,I)=0 THEN BF$(E,R)=BF$(E,R)+BL$:GOTO 230
220 BF$(E,R)=BF$(E,R)+SS$(E,R)
230 NEXT I
236 PT=PT+32
240 NEXT R
245 PT=PT+32
250 NEXT E
290 RETURN
291 PT=P0
292 FOR E = 1 TO ET
293 FOR R = 1 TO HT
294 PRINT @ PT, BF$(E,R);
295 PT=PT+32
296 NEXT R
297 PT=PT+32
298 NEXT E
299 RETURN
300 REM RENDER
310 REM CLS 0
325 FOR SS=1 TO 2
316 OF=(SS-1)*32*5
320 FOR P=P+OF TO P0+OF+20 STEP 10
330 GOSUB 600
340 NEXT P
350 NEXT SS
360 RETURN
400 REM LOAD SPRITE
410 FOR L=1 TO HT
420 GOSUB 500
430 SP$(L)=L$
435 PRINT SP$(L)
440 NEXT
450 RETURN
500 REM LOAD ALIEN STRING
505 L$ = ""
510 FOR I = 1 TO WD
520 READ CH
530 L$ = L$ + CHR$(CH+CLR(S))
540 NEXT
550 RETURN
600 REM DISPLAY SPRITE
605 PT=P
610 FOR L = 1 TO HT
620 PRINT @ PT, SS$(SS, L);
630 PT=PT+32
640 NEXT
650 RETURN
700 ' DESTROY ENEMY
710 FOR L = 1 TO HT
715 CP=CR*WD+1
720 MID$(BF$(RR,L),CP,WD)=STRING$(WD, CHR$(128))
730 NEXT
740 EC=EC-1
745 SC=SC+100
750 IF EC<=0 THEN MG$="YOU WON!":GOTO 140
790 RETURN
800 ' LAUNCH MISSILE
801 ML=1
802 IF (MX(ML)>0) AND (ML<MM) THEN ML=ML+1:GOTO 802
803 IF ML>MM THEN RETURN
810 MX(ML)=FNX(B0)+WD
815 MY(ML)=FNY(B0)
816 MC=MC+1
820 RETURN
830 MY(ML)=FNY(B0)
850 ' RENDER MISSILES
855 FOR M=1 TO MM ' DRAW EACH MISSILE
860 IF MX(M) <= 0 GOTO 880
862 PT = POINT(MX(M), MY(M))
865 SET(MX(M), MY(M), 1)
866 RESET (MX(M), MY(M)+2)
870 MY(M)=MY(M)-1
875 IF MY(M) <= 0 THEN MX(M)=0
878 IF PT > 2 THEN GOSUB 900
880 NEXT
890 RETURN
900 X0 = FNX(P0) : Y0 = FNY(P0) ' COLLISION DETECTION
910 FOR R=0 TO ET - 1 
915 W = WD*2
916 H = EH*2
917 X=MX(M)
918 Y=MY(M)
920 FOR C=0 TO PR - 1 
921 F1 = X0+(C+1)*W >= X
922 F2 = X0+C*W <= X
923 F3 = Y0+R*H <= Y
924 F4 = Y0+(R+1)*H >= Y
930 IF NOT(F1 AND F2 AND F3 AND F4) THEN 940
931 CR=C: RR=R+1
932 ES(RR,CR+1)=0
933 GOSUB 700
935 RESET(MX(M),MY(M)+2)
937 MX(M)=-1
938 MC=MC-1
939 RETURN
940 NEXT C
950 NEXT R
954 CR=-1 : RR = -1
955 RETURN
998 REM CRAB ALIEN
999 DATA 128
1000 DATA 128,137,128,128,134,128
1004 DATA 128,128
1005 DATA 129,142,143,143,141,130
1009 DATA 128,128
1010 DATA 142,143,143,143,143,141
1014 DATA 128,128
1015 DATA 136,137,130,129,134,132
1016 DATA 128
1020 REM OCTOPUS ALIEN
1030 DATA 128,129,131,143,143,131,130,128
1040 DATA 128,131,142,141,142,141,131,128
1050 DATA 128, 140,141,142,141,142,140,128
1060 DATA 128,131,140,132,136,140,131,128
1070 REM BLASTERE
1080 DATA 128,128,128,135,139,128,128,128
1090 DATA 128,135,143,143,143,143,139,128
1100 DATA 128,143,143,143,143,143,143,128
1110 DATA 128,128,128,128,128,128,128,128
1200 ' DROP BOMB
1205 FOR R=1 TO ET
1210 FOR C=1 TO PR
1220 IF ES(R,C)=0 THEN 1270
1225 CH=RND(100)
1230 IF CH < 99 THEN 1270
1235 B = 1
1236 BM = 10
1240 IF (BY(B)>0) AND (B<BM) THEN B=B+1:GOTO 1240
1245 IF B >= BM THEN RETURN
1250 BY(B) = R*EH*2
1255 BX(B) = C*WD+P0*2
1256 SET(BX(B),BY(B),8)
1270 NEXT C : NEXT R
1280 RETURN

1300 'RENDER BOMBS
1305 YMAX=31
1310 FOR B=1 TO BM
1315 IF BY(B)=0 THEN 1350
1316 IF POINT(BX(B),BY(B))=2 THEN MG$="YOU DIED!":GOTO 140
1317 IF BY(B)>=YMAX THEN RESET(BX(B),BY(B)-1):BY(B)=0:GOTO 1350
1320 SET(BX(B),BY(B),5)
1325 RESET(BX(B),BY(B)-1)
1330 BY(B)=BY(B)+1
1350 NEXT
1360 RETURN
