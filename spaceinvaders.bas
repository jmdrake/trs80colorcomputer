' LOAD ENEMY SPRITES
' LOAD LAUNCHER SPRITE
' DRAW BUNKERS
' GAME LOOP
' - DRAW ENEMIES
' - RANDOMLY DROP BOMBS
' - MOVE ENEMIES
' - DRAW BOMBS
' - DRAW LAUNCHER
' - GET INPUT
' -   - A - MOVE LEFT
' -   - D - MOVE RIGHT
' -   - S - FIRE MISSILE
' - DRAW MISSILES
' : FIRE MISSILE - INPUT SHIP X (SX), SHIP Y (SY), SHIP WIDTH (SW)
'  - LOOP THROUGH MISSILE ARRAY
'    - IF MX(M) = 0 THEM MX(M) = SX + SW/2: MY(M) = SY
'    - RETURN
' : DRAW MISSILES
' -   - LOOP M THROUGH MISSILE ARRAY
' -   - IF MX(M) > 0
'      - IF ENEMY HIT THEN DESTORY ENEMY: UPDATE SCORE:MX(M)=0
'      - IF BUNKER HIT THEN DAMAGE BUNKER: MX(M)=0
'      - MY(M) = MY(M) - 1
'      - IF MY(M) < 0 THEN MX(M)=0
'     RETURN
' - : DRAW ENEMIES STANDARD VERSION
'     P = P0 
' -   FOR R = 1 TO ER
'     SS = R
'     FOR C = 1 TO EC
'     DRAW SPRITE
'     P0 = P0 + EW
'     NEXT C
'     P0 = P0 + 32*EH+1
'     NEXT R
1 MM = 10 ' Maximum Missiles
2 MB = 10  ' Maximum Bombs
3 ED = 1   ' Enemy Direction
4 RD = 48  ' RED
5 BU = 32  ' BLUE
6 YW = 16  ' YELLOW
7 EC = 3  ' Enemy Count Per Row
8 ER = 2  ' Enemy Rows

10 DEF FNY(P)=INT(P/16)
11 DEF FNX(P)=2*(P-32*INT(P/12))
12 DEF FNPX(X)=X/2
13 DEF FNPY(Y)=7*16
14 DEF FNSW(S$)=ASC(LEFT$(S$,1))
15 DEF FNSH(S$)=ASC(MID$(S$,2,1))

25 DIM SS(ER+2)
26 DIM MX(MM), MY(MM) ' Missle X and Y arrays
27 DIM EN(ER, EC)     ' Enemies matrix

29 ' LOAD ENEMY SPRITES
30 FOR I = 1 TO EC
31 SS = I
32 GOSUB READSPRITE
33 NEXT
34 EW = SW

39 ' LOAD LAUNCHER SPRITE
40 SS = SS + 1
41 GOSUB READSPRITE
42 LW = SW

49 ' LOAD BUNKER SRITE
50 SS = SS + 1
51 GOSUB READSPRITE
52 BW = SW   ' BUNKER WIDTH FROM SPRITE TABLE

60 ' DRAW BUNKERS
61 CLS 0
62 P = B0 : SS = ER + 2
63 FOR I = 1 TO 3
64 GOSUB DRAWSPRITE
65 P = P + BW ' ADD BUNKER WIDTH TO P
66 NEXT I

100 ' GAME LOOP
101 GOSUB DRAWENEMIES
102 GOSUB DROPBOMBS
103 GOSUB DRAWBOMBS
104 GOSUB CHECKDIRECTION
105 E0 = E0 + ED
106 GOSUB DRAWLAUNCHER

110 ' GET INPUT
111 IF PEEK(KL) = 247 AND L > L0 THEN L = L - 1
112 IF PEEK(KR) = 247 AND L < LN THEN L = L + 1
113 IF PEEK(KU) = 247 THEN GOSUB FIREMISSILE

115 GOSUB 121
116 GOTO 101

120 ' DRAW MISSILES
121 FOR M = M0 TO MM
122 RESET(MX(M), MY(M)+1)
123 IF MX(M) = 0 THEN GOTO 129
124 C = POINT(MX(M), MY(M))
125 IF C = C1 OR C = C2 THEN GOSUB ENEMYCOLLISION: RESET(MX(M),MY(M)) : GOTO 129
126 IF C = BC THEN MX(M) = 0: GOTO 129
127 SET(MX(M), MY(M), C4)
128 MY(M) = MY(M)-11
129 NEXT ' SKIPMISSILE
130 RETURN

140 ' ENEMYCOLLISION
141 E = E0
142 FOR R = 1 TO ER
143 FOR C = 1 TO EC
144 X0 = FNX(E)
145 Y0 = FNY(E)
146 XN = X0 + EW
147 YN = Y0 + EH
148 IF NOT(MX(M) >= X0 AND MX(M) <= XN AND MY(M) >= Y0 AND MY(M) <= YN) THEN SKIPCOLLION
149 MX(M) = 0
150 EN(R,C)=0 : GOSUB DESTORYENEMY
151 SCORE = SCORE + 100
152 ET = ET - 1
153 IF ET = 0 THEN MG$ = "YOU WON": GOTO ENDGAME
154 NEXT ' SKIPCOLLISION
155 RETURN

160 ' FIRE MISSILE - INPUT SHIP X (SX), SHIP Y (SY), SHIP WIDTH (SW)
161 '  - LOOP THROUGH MISSILE ARRAY
162 SX = FNP2X(S0) : SY = FNP2Y(S0)
163 FOR M=1 TO MC 
164 IF MX(M) = 0 THEM MX(M) = SX + SW/2: MY(M) = SY:RETURN
165 NEXT
166 RETURN

170 ' DRAW ENEMIES STANDARD VERSION
171 P = P0 
172 FOR R = 1 TO ER
173 SS = R
174 FOR C = 1 TO EC
175 SS  = EN(R,C)
176 IF SS > 0 THEN GOSUB DRAWSPRITE
177 P0 = P0 + EW
178 NNEXT C
179 P0 = P0 + 32*EH+1
180 NEXT R

200 ' DROP BOMBS
201 FOR R = 1 TO ER
202 FOR C = 1 TO EC
202 IF EN(R,C)=0 THEN GOTO 
203 CH=RND(100) ' RANDOM CHANCE
205 IF CH < 99 THEN 
206 B = 1 : BM = 10
207 IF (BY(B)>0) AND (B  BM) THEN B=B+1:GOTO 207
208 IF B > BM THEN RETURN
209 BY(B) = R*EH*2
210 BX(B) = C*WD+P0+2
211 SET(BX(B),BY(B),8)
212 NEXT C
213 NEXT R
214 RETURN

300 ' RENDER BOMBS

400 ' DESTROY ENEMY

1000 ' CRAB ALIEN
1001 DATA 8, 4
1002 DATA 128, 128, 137, 128, 128, 134, 128, 128
1003 DATA 128, 129, 142, 143, 143, 141, 130, 128
1004 DATA 128, 142, 143, 143, 143, 143, 141, 128
1005 DATA 128, 136, 137, 130, 129, 124, 132, 128

