' LOAD ENEMY SPRITES
' LOAD LAUNCHER SPRITE
' DRAW BUNKERS
' GAME LOOP
' - DRAW ENEMIES
' - RANDOMLY DROP BOMBS
' - MOVE ENEMIES
' - DRAW BOMBS
' - DRAW LAUNCHER
' - GET INPUT
' -   - A - MOVE LEFT
' -   - D - MOVE RIGHT
' -   - S - FIRE MISSILE
' - DRAW MISSILES
' : FIRE MISSILE - INPUT SHIP X (SX), SHIP Y (SY), SHIP WIDTH (SW)
'  - LOOP THROUGH MISSILE ARRAY
'    - IF MX(M) = 0 THEM MX(M) = SX + SW/2: MY(M) = SY
'    - RETURN
' : DRAW MISSILES
' -   - LOOP M THROUGH MISSILE ARRAY
' -   - IF MX(M) > 0
'      - IF ENEMY HIT THEN DESTORY ENEMY: UPDATE SCORE:MX(M)=0
'      - IF BUNKER HIT THEN DAMAGE BUNKER: MX(M)=0
'      - MY(M) = MY(M) - 1
'      - IF MY(M) < 0 THEN MX(M)=0
'     RETURN
' - : DRAW ENEMIES STANDARD VERSION
'     P = E0 
' -   FOR R = 1 TO ET
'     SS = R
'     FOR C = 1 TO EC
'     DRAW SPRITE
'     P0 = P0 + EW
'     NEXT C
'     P0 = P0 + 32*EH+1
'     NEXT R
9  ' HELPER FUNCTIONS
10 DEF FNY(P)=INT(P/16)
11 DEF FNX(P)=2*(P-32*INT(P/32))
12 DEF FNPX(X)=X/2
13 DEF FNPY(Y)=7*16

20 ' VARIABLE INITIALIZATION
21 MM = 10 ' Maximum Missiles
22 MB = 10  ' Maximum Bombs
23 ED = 1   ' Enemy Direction
24 RD = 48  ' RED
25 BU = 32  ' BLUE
26 YW = 16  ' YELLOW
27 EC = 3  ' Enemy Count Per Row
28 ET = 2  ' Enemy Types
29 SC = 0  ' SCORE
30 SH = 4  ' SPRITE HEIGHT
31 B0 = 11*32+4
32 MX = 9:MN=0
33 KL = 343	' KEY LEFT
34 KR = 344	' KEY RIGHT
35 KU = 341	' KEY UP

40 ' ARRAYS
41 DIM CLR(3) : CLR(1)=RD : CLR(2)=BU: CLR(3)=YW ' COLORS
42 DIM SP$(SH)  ' SPRITE
43 DIM SS$(ET+2, SH) ' 
44 DIM MX(MM), MY(MM) ' Missle X and Y arrays
45 DIM EN(ET, EC)     ' Enemies matrix
49 ? "LOADING ENEMIES"
50 ' LOAD ENEMY SPRITES
51 FOR E = 1 TO ET
52 SS = E
53 GOSUB 400
54 NEXT
55 EW = WD:EH=HT
56 FOR R=1 TO ET:FOR C=1 TO EC:EN(R,C)=R:NEXT C:NEXT R

59 ? "LOADING LAUNCHER"
60 ' LOAD LAUNCHER SPRITE
61 SS = SS + 1:SL=SS
62 GOSUB 400
63 LW = WD:LR=14
64 LP = LR*32+10
65 LN = (LR+1)*32-LW
66 L0 = LR*32

69 ? "LOADING BUNKER"
70 ' LOAD BUNKER SRITE
71 SS = SS + 1:SB=SS
72 GOSUB 400
73 BW = WD   ' BUNKER WIDTH FROM SPRITE TABLE

80 ' DRAW BUNKERS
81 CLS 0
82 P = B0 : SS = SB
83 FOR I = 1 TO 3
84 GOSUB 600
85 P = P + WD + 2 ' ADD BUNKER WIDTH TO P
86 NEXT I

100 ' GAME LOOP
101 GOSUB 170	' DRAW ENEMIES
102 GOSUB 200	' DROP BOMBS
103 GOSUB 300	' DRAW BOMBS
104 GOSUB 130	' CHECK DIRECTION
105 E0 = E0 + ED ' MOVE ENEMIES
106 GOSUB 120	' DRAW LAUNCHER

110 ' GET INPUT
111 IF PEEK(KL) = 247 AND LP > L0 THEN LP = LP - 1
112 IF PEEK(KR) = 247 AND LP < LN THEN LP = LP + 1
113 IF PEEK(KU) = 247 THEN GOSUB 160

115 GOSUB 500
116 GOTO 101

117 ?MG$ : END

120 ' DRAWLAUNCHER
121 P=LP
122 SS=SL
123 GOSUB 600
124 RETURN

130 ' CHECKDIRECTION
131 IF E0 >= MX THEN E0 = MX:ED=-1
132 IF E0 <= MN THEN E0 = MN:ED=1
133 RETURN


140 ' ENEMYCOLLISION
141 E = E0
142 FOR R = 1 TO ET
143 FOR C = 1 TO EC
144 X0 = FNX(E)
145 Y0 = FNY(E)
146 XN = X0 + EW
147 YN = Y0 + EH
148 IF NOT(MX(M) >= X0 AND MX(M) <= XN AND MY(M) >= Y0 AND MY(M) <= YN) THEN 154
149 MX(M) = 0
150 EN(R,C)=0 : GOSUB DESTORYENEMY
151 SCORE = SCORE + 100
152 ET = ET - 1
153 IF ET = 0 THEN MG$ = "YOU WON": GOTO ENDGAME
154 NEXT ' SKIPCOLLISION
155 RETURN


160 ' LAUNCH MISSILE
161 ML=1
162 IF (MX(ML)>0) AND (ML<MM) THEN ML=ML+1:GOTO 162
163 IF ML>MM THEN RETURN
164 MX(ML)=FNX(LP)+WD
165 MY(ML)=FNY(LP)
166 MC=MC+1
167 RETURN

170 ' DRAW ENEMIES STANDARD VERSION
171 P = E0 
172 FOR R = 1 TO ET
173 SS = R
174 FOR C = 1 TO EC
175 SS  = EN(R,C)
176 IF SS > 0 THEN GOSUB 600
177 P = P + EW
178 NEXT C
179 P = E0 + 32*(EH+1)
180 NEXT R
190 RETURN

200 ' DROP BOMBS
201 FOR R = 1 TO ET
202 FOR C = 1 TO EC
203 IF EN(R,C)=0 THEN GOTO 212
204 CH=RND(100) ' RANDOM CHANCE
205 IF CH < 99 THEN 212
206 B = 1 : BM = 10
207 IF (BY(B)>0) AND (B  BM) THEN B=B+1:GOTO 207
208 IF B > BM THEN RETURN
209 BY(B) = R*EH*2
210 BX(B) = C*WD+E0+2
211 SET(BX(B),BY(B),8)
212 NEXT C
213 NEXT R
214 RETURN

300 'RENDER BOMBS
305 YMAX=31
310 FOR B=1 TO BM
315 IF BY(B)=0 THEN 350
316 IF POINT(BX(B),BY(B))=2 THEN GOSUB 370 
317 IF BY(B)>=YMAX THEN RESET(BX(B),BY(B)-1):BY(B)=0:GOTO 350
320 SET(BX(B),BY(B),5)
325 RESET(BX(B),BY(B)-1)
330 BY(B)=BY(B)+1
350 NEXT
360 RETURN

370 ' CHECK BOMB COLLISION
371 IF BY(B) >= LR * 2 THEN: MG$="YOU DIED!":GOTO 117
372 RESET(BX(B),BY(B))
373 RETURN

400 ' READSPRITE
401 READ WD, HT, CL
402 SS$(SS,0)=CHR$(WD)+CHR$(HT)+CHR$(CL)  ' STORE METADATA
403 FOR L=1 TO HT
404 L$ = ""
405 FOR I = 1 TO WD
406 READ CH
407 L$ = L$+CHR$(CH+CL)
408 NEXT I
409 SS$(SS,L) = L$
410 PRINT SS$(SS,L)
411 NEXT L
412 RETURN

500 ' RENDER MISSILES
501 FOR M=1 TO MM ' DRAW EACH MISSILE
502 IF MX(M) <= 0 GOTO 509
503 PT = POINT(MX(M), MY(M))
504 SET(MX(M), MY(M), 1)
505 RESET (MX(M), MY(M)+2)
506 MY(M)=MY(M)-1
507 IF MY(M) <= 0 THEN MX(M)=0
508 IF PT > 2 THEN GOSUB 900
509 NEXT
510 RETURN

600 ' DRAWSPRITE
610 PT=P
615 MD$=SS$(SS,0)
616 HT=ASC(MID$(SS$(SS,0),2,1))
617 WD=ASC(MID$(SS$(SS,0),1,1))
620 FOR L = 1 TO HT
630 PRINT @ PT, SS$(SS,L);
640 PT=PT+32
650 NEXT
660 RETURN



700 ' DESTROY ENEMY





900 X0 = FNX(P0) : Y0 = FNY(P0) ' COLLISION DETECTION
910 FOR R=0 TO ET - 1 
915 W = WD*2
916 H = EH*2
917 X=MX(M)
918 Y=MY(M)
920 FOR C=0 TO PR - 1 
921 F1 = X0+(C+1)*W >= X
922 F2 = X0+C*W <= X
923 F3 = Y0+R*H <= Y
924 F4 = Y0+(R+1)*H >= Y
930 IF NOT(F1 AND F2 AND F3 AND F4) THEN 940
931 CR=C: RR=R+1
932 ES(RR,CR+1)=0
933 GOSUB 700
935 RESET(MX(M),MY(M)+2)
937 MX(M)=-1
938 MC=MC-1
939 RETURN
940 NEXT C
950 NEXT R
954 CR=-1 : RR = -1
955 RETURN

1000 ' CRAB ALIEN
1001 DATA 8, 4, 48
1002 DATA 128, 128, 137, 128, 128, 134, 128, 128
1003 DATA 128, 129, 142, 143, 143, 141, 130, 128
1004 DATA 128, 142, 143, 143, 143, 143, 141, 128
1005 DATA 128, 136, 137, 130, 129, 134, 132, 128

1010 ' OCTOPUS ALIEN
1011 DATA 8, 4, 32
1012 DATA 128,129,131,143,143,131,130,128
1013 DATA 128,131,142,141,142,141,131,128
1014 DATA 128, 140,141,142,141,142,140,128
1015 DATA 128,131,140,132,136,140,131,128

1020 ' LAUNCHER
1021 DATA 8, 2, 16
1022 DATA 128,128,128,135,139,128,128,128
1023 DATA 128,135,143,143,143,143,139,128

1030 ' BUNKER
1031 DATA 8, 2, 16
1034 DATA 135,143,143,143,143,143,143,139
1035 DATA 143,143,143,143,143,143,143,143
